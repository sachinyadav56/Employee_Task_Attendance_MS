<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard | ETAMS</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4f46e5;
            --bg-light: #f1f5f9;
        }

        body {
            background-color: var(--bg-light);
            font-family: 'Inter', sans-serif;
            color: #334155;
            /* Global Font Reduction */
            font-size: 0.85rem; 
        }

        .navbar {
            background: #1e293b;
            padding: 0.5rem 1.5rem; /* Reduced height */
        }
        
        .navbar-brand { font-size: 1rem; }

        /* --- Header Section --- */
        .welcome-section {
            padding: 1.25rem 0; /* Reduced padding */
            background: white;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
        }

        h2 { font-size: 1.25rem; } /* Reduced from default h2 */
        h5 { font-size: 0.95rem; } /* Reduced from default h5 */
        h6 { font-size: 0.85rem; }

        /* --- Compact Cards --- */
        .dashboard-card {
            border: none;
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1rem !important; /* Tight padding */
        }

        .stat-icon {
            width: 36px; /* Smaller icon boxes */
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }

        .icon-blue { background: #e0e7ff; color: #4338ca; }
        .icon-green { background: #dcfce7; color: #15803d; }

        /* --- Task List --- */
        .task-list-item {
            border-left: 3px solid #cbd5e1;
            padding: 0.6rem 1rem !important;
            margin-bottom: 8px;
            font-size: 0.8rem; /* Smaller text for task items */
        }

        .btn-custom {
            font-size: 0.75rem; /* Small buttons */
            padding: 4px 12px;
            border-radius: 6px;
        }

        .badge {
            font-size: 0.7rem;
            padding: 0.35em 0.65em;
        }

        .small-text {
            font-size: 0.75rem;
            color: #64748b;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark sticky-top shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">
            <i class="bi bi-cpu-fill me-2"></i> ETAMS
        </a>
        <div class="d-flex gap-2">
            <a href="{% url 'attendance_report' %}" class="btn btn-outline-light btn-custom">
                Attendance
            </a>
            <a href="{% url 'employee_logout' %}" class="btn btn-danger btn-custom">
                Logout
            </a>
        </div>
    </div>
</nav>

<div class="welcome-section shadow-sm">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-8">
                <h2 class="fw-bold mb-0">Hi, {{ employee.user.username }}</h2>
                <div class="small-text mt-1">
                    <span class="badge bg-primary-subtle text-primary border border-primary-subtle">{{ employee.role }}</span>
                    <span class="ms-2">{{ employee.department.name }} Department</span>
                </div>
            </div>
            <div class="col-4 text-end border-start">
                <div class="small-text">Employee ID</div>
                <div class="fw-bold text-dark">#{{ employee.employee_id }}</div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row g-3">
        
        <div class="col-lg-4">
            <div class="card dashboard-card h-100">
                <div class="stat-icon icon-green">
                    <i class="bi bi-person-check"></i>
                </div>
                <h5 class="fw-bold mb-3">Today's Attendance</h5>
                
                {% if attendance %}
                <div class="d-flex justify-content-between mb-2">
                    <span>Status:</span>
                    <span class="badge bg-success">{{ attendance.status }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span class="small-text">Login:</span>
                    <span class="fw-medium small-text text-dark">{{ attendance.login_time|time:"h:i A" }}</span>
                </div>
                <div class="d-flex justify-content-between mb-1">
                    <span class="small-text">Logout:</span>
                    <span class="fw-medium small-text text-dark">{{ attendance.logout_time|time:"h:i A"|default:"--" }}</span>
                </div>
                <hr class="my-2">
                <div class="d-flex justify-content-between">
                    <span class="fw-bold">Net Hours:</span>
                    <span class="text-primary fw-bold">{{ attendance.net_working_hours|default:"0" }}h</span>
                </div>
                {% else %}
                <div class="text-center py-3">
                    <p class="small-text mb-0">No record for today.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card dashboard-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">Active Tasks</h5>
                    <a href="{% url 'assign_task' %}" class="btn btn-primary btn-custom">View All</a>
                </div>

                <div class="list-group list-group-flush">
                    {% if tasks %}
                        {% for task in tasks|slice:":4" %}
                        <div class="list-group-item bg-light border task-list-item rounded shadow-sm">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="fw-bold {% if task.is_completed %}text-decoration-line-through text-muted{% endif %}">
                                        {{ task.title }}
                                    </div>
                                    <div class="small-text text-truncate" style="max-width: 300px;">{{ task.description }}</div>
                                </div>
                                <div>
                                    {% if not task.is_completed %}
                                        <a href="{% url 'update_task_status' task.id %}" class="btn btn-outline-success btn-custom" style="padding: 2px 8px;">Done</a>
                                    {% else %}
                                        <i class="bi bi-check-circle-fill text-success"></i>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="small-text text-center py-3">No tasks found.</p>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>
</div>

</body>
</html>